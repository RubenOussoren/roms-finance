<%# locals: (account:, title:, subtitle: nil) %>

<header class="space-y-4">
  <% if account.is_joint? && !account.owned_by?(Current.user) %>
    <%= render DS::Alert.new(
      message: "#{account.created_by_user.display_name} linked this joint account. Both members have full access.",
      variant: :info
    ) %>
  <% end %>

  <div class="flex items-center gap-4">
    <div class="flex items-center gap-3 overflow-hidden">
      <%= render "accounts/logo", account: account %>

      <div class="flex items-center gap-2">
        <div class="truncate">
          <div class="flex items-center gap-3">
            <h2 class="font-medium text-xl truncate <%= "animate-pulse" if account.syncing? %>"><%= title %></h2>
            <% if account.is_joint? %>
              <span class="text-xs bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded font-medium">Joint</span>
            <% end %>
            <% if account.draft? %>
              <%= render DS::Link.new(
                  text: "Complete setup",
                  href: edit_account_path(account),
                  variant: :outline,
                  size: :sm,
                  frame: :modal
                ) %>
            <% end %>
          </div>
          <% if subtitle.present? %>
            <p class="text-sm text-secondary"><%= subtitle %></p>
          <% end %>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-1 ml-auto">
      <% if Rails.env.development? || self_hosted? %>
        <%= icon(
            "refresh-cw",
            as_button: true,
            size: "sm",
            href: if account.plaid_account_id.present?
                    sync_plaid_item_path(account.plaid_account.plaid_item)
                  elsif account.snaptrade_account_id.present?
                    sync_snaptrade_connection_path(account.snaptrade_account.snaptrade_connection)
                  else
                    sync_account_path(account)
                  end,
            disabled: account.syncing?,
            frame: :_top
          ) %>
      <% end %>

      <%= render "accounts/show/menu", account: account %>
    </div>
  </div>
</header>
