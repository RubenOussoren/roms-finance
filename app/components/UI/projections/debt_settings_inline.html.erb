<%= turbo_frame_tag settings_frame_id do %>
  <details class="mt-4 bg-surface-inset rounded-lg">
    <summary class="px-4 py-3 cursor-pointer flex items-center justify-between list-none">
      <div class="flex items-center gap-2">
        <%= helpers.icon "sliders-horizontal", size: "sm", class: "text-secondary" %>
        <span class="text-sm font-medium text-primary">Repayment Settings</span>
        <% if custom_settings? %>
          <span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">Custom</span>
        <% end %>
      </div>
      <div class="flex items-center gap-2">
        <% if has_savings? %>
          <span class="text-xs text-green-600"><%= potential_savings_formatted %> saved</span>
        <% end %>
        <%= helpers.icon "chevron-down", size: "sm", class: "text-secondary transition-transform duration-200 details-open:rotate-180" %>
      </div>
    </summary>

    <div class="px-4 pb-4 border-t border-secondary pt-4">
      <%= form_with url: form_url, method: :patch, data: { controller: "auto-submit-form", turbo_frame: chart_frame_id } do |form| %>
        <div class="grid grid-cols-2 gap-4">
          <div class="space-y-1">
            <label class="text-xs font-medium text-secondary">Extra Monthly Payment (<%= currency_symbol %>)</label>
            <%= form.number_field :extra_monthly_payment,
                value: extra_monthly_payment,
                step: 50,
                min: 0,
                placeholder: "0",
                class: "w-full bg-container border border-secondary rounded-lg px-3 py-2 text-sm text-primary focus:outline-hidden focus:ring-1 focus:ring-blue-500",
                data: { "auto-submit-form-target": "auto" } %>
            <p class="text-xs text-tertiary">Additional payment beyond minimum</p>
          </div>

          <div class="space-y-1">
            <label class="text-xs font-medium text-secondary">Target Payoff Date</label>
            <%= form.date_field :target_payoff_date,
                value: target_payoff_date_formatted,
                min: Date.current.strftime("%Y-%m-%d"),
                class: "w-full bg-container border border-secondary rounded-lg px-3 py-2 text-sm text-primary focus:outline-hidden focus:ring-1 focus:ring-blue-500",
                data: { "auto-submit-form-target": "auto" } %>
            <p class="text-xs text-tertiary">Optional goal date</p>
          </div>
        </div>

        <% if custom_settings? %>
          <div class="mt-3 flex justify-end">
            <%= button_to "Reset to defaults",
                reset_url,
                method: :delete,
                class: "text-xs text-link hover:underline",
                data: { turbo_frame: settings_frame_id, confirm: "Reset repayment settings?" } %>
          </div>
        <% end %>
      <% end %>
    </div>
  </details>
<% end %>
