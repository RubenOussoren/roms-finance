<%= turbo_frame_tag chart_frame_id do %>
  <% if has_data? %>
    <div class="bg-container shadow-border-xs rounded-xl space-y-2">
      <%# Chart header with hero metric and supporting details %>
      <div class="flex justify-between flex-col-reverse lg:flex-row gap-2 px-4 pt-4 mb-2">
        <div class="space-y-2 w-full">
          <%# Primary: Remaining Balance (hero metric) %>
          <div class="flex items-center gap-1">
            <p class="text-sm font-medium text-secondary">Remaining Balance</p>
          </div>
          <div class="flex flex-row gap-2 items-baseline">
            <p class="text-primary text-3xl font-medium truncate"><%= current_balance_formatted %></p>
            <p class="text-sm font-medium text-secondary">in <%= time_remaining_formatted %></p>
          </div>

          <%# Supporting details: payment, rate, total interest %>
          <div class="flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-secondary">
            <span><%= monthly_payment_formatted %> payment</span>
            <span>&bull;</span>
            <span><%= interest_rate_formatted %> rate</span>
          </div>

          <div class="flex items-center gap-2 text-xs text-tertiary">
            <span>Total interest:</span>
            <span class="text-secondary"><%= total_interest_formatted %></span>
            <span>&bull;</span>
            <span>Payoff:</span>
            <span class="text-secondary"><%= payoff_date_formatted %></span>
          </div>
        </div>
      </div>

      <%# Chart %>
      <div class="h-64 pb-4">
        <div
          id="<%= chart_frame_id %>-chart"
          class="w-full h-full"
          data-controller="debt-payoff-chart"
          data-debt-payoff-chart-data-value="<%= chart_data %>">
        </div>
      </div>

      <%# Legend %>
      <div class="px-4 pb-4">
        <div class="flex flex-wrap items-center gap-4 text-xs text-tertiary">
          <div class="flex items-center gap-1">
            <span class="w-3 h-0.5 bg-blue-500"></span>
            <span>Current schedule</span>
          </div>
          <% if extra_payment.positive? %>
            <div class="flex items-center gap-1">
              <span class="w-3 h-0.5 border-t border-dashed border-green-500"></span>
              <span>With extra payment</span>
            </div>
          <% end %>
        </div>

        <%# Impact banner when extra payment is active %>
        <% if has_impact? %>
          <div class="flex items-center gap-2 mt-3 px-3 py-2 bg-green-50 border border-green-200 rounded-lg">
            <%= helpers.icon "trending-down", size: "sm", class: "text-green-600" %>
            <span class="text-sm text-green-700">
              <% if interest_saved_formatted && months_saved_formatted %>
                Save <%= interest_saved_formatted %> &bull; <%= months_saved_formatted %> faster
              <% elsif interest_saved_formatted %>
                Save <%= interest_saved_formatted %> in interest
              <% elsif months_saved_formatted %>
                Pay off <%= months_saved_formatted %> faster
              <% end %>
            </span>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="bg-container shadow-border-xs rounded-xl">
      <div class="text-center py-8 text-secondary">
        <p class="text-sm">Unable to calculate payoff schedule</p>
        <p class="text-xs mt-1">Check that interest rate and monthly payment are set</p>
      </div>
    </div>
  <% end %>
<% end %>
